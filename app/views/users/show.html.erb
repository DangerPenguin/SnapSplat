<div class="pagebox">

	<div id="user_feed">
		<div class="inputbox" >
			<h1><%= @user.username %>'s page!</h1>
			
			<br>
			
			<% if(current_user.id != @user.id) %>
				
					<button id="unfollowButton" onclick="unfollow('<%= current_user.id %>')" 	
						<% unless(current_user.following.include?(@user)) %>
							class="hidden"
							data-id="nope"
						<% else %>
							data-id="<%= current_user.following_join.where({:following_id => @user.id }).first.id %>"
						<% end  %>
						>UNFOLLOW</button>
				
					<button id="followButton" onclick='follow("<%= current_user.id %>", "<%= @user.id %>")'
						<% if(current_user.following.include?(@user)) %>
							class="hidden"
						<% end  %>
						
						>FOLLOW</button>
				
				<br>
			<% else  %>
				<a href="<%= edit_user_url(current_user) %>">
					<button  >Edit Profile</button></a>
				
			<% end %>
			
				<span style="text-align: left;"><h4>Tagline: </h4></span>
			<p style="width: 400px; word-wrap:normal"><%= @user.tagline %></p>

			<br>

			<span style="text-align: left;"><h4>Blurb: </h4></span>
			<p style="width: 400px; word-wrap:normal" ><%= @user.blurb %></p>
			<br>
			
			
			<h4>Photos: </h4>
			<% @user.photos.each do |photo| %>
				<img style="display: inline;" src="<%= photo.url %>" width="400" onclick='$.modal( createModal( "<%= photo.url %>" ), { "overlayClose": true } );'>	
				<br>
				<br>
			<% end %>
			
		</div>
	</div>
</div>

<script type="text/javascript">

function createModal (url) {
	return "<div><img src='" + url + "' width='700' ></div>";
}

function follow(user_id, id){
	$.ajax({
		url: "/users/" + user_id + "/follows/",
		type: "POST",
		data: {
			'follow': {
				'follower_id': user_id,
				'following_id': id	
			}
		},
		success: function(responseData){
			console.log("Success following!");
			console.log(responseData);
			$('#unfollowButton').attr('data-id', responseData.id);
			
			$('#unfollowButton').removeClass("hidden");
			$('#followButton').addClass("hidden");
			
		},
		failure: function(responsoData){
			console.log("Failure following!");
			console.log(responseData);
		}
	});
}


function unfollow(user_id){
	var id = $('#unfollowButton').attr('data-id');
	
	$.ajax({
		url: "/users/" + user_id + "/follows/" + id,
		type: "DELETE",
		success: function(responseData){
			console.log("Success unfollowing!");
			console.log(responseData);
			$('#unfollowButton').addClass("hidden");
			$('#followButton').removeClass("hidden");
		},
		failure: function(responsoData){
			console.log("Failure unfollowing!");
			console.log(responseData);
		}
	});
}
</script>